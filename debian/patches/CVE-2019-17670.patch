Origin: https://core.trac.wordpress.org/changeset/46472
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2020-09-09

From: Sergey Biryukov <sergeybiryukov.ru@gmail.com>
Date: Mon, 14 Oct 2019 10:52:04 +0000
Subject: [PATCH] Formatting: In `wp_validate_redirect()`, normalize the path
 when validating the location for relative URLs, to account for Windows paths.

Props peterwilsoncc, rconde, jmmathc, mat-lipe, Sixes, justinahinon, cmagrin, daxelrod, SergeyBiryukov.
Fixes #47980.
Built from https://develop.svn.wordpress.org/trunk@46472

Index: wordpress-4.7.18/wp-includes/pluggable.php
===================================================================
--- wordpress-4.7.18.orig/wp-includes/pluggable.php
+++ wordpress-4.7.18/wp-includes/pluggable.php
@@ -1319,6 +1319,7 @@ function wp_validate_redirect($location,
 		$path = '';
 		if ( ! empty( $_SERVER['REQUEST_URI'] ) ) {
 			$path = dirname( parse_url( 'http://placeholder' . $_SERVER['REQUEST_URI'], PHP_URL_PATH ) . '?' );
+			$path = wp_normalize_path( $path );
 		}
 		$location = '/' . ltrim( $path . '/', '/' ) . $location;
 	}
